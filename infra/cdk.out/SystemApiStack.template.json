{
 "Description": "Read-only System API using AppSync with DynamoDB and Aurora PostgreSQL data sources",
 "Resources": {
  "AppSyncApiApiLogsRoleB99A02E9": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "appsync.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSAppSyncPushToCloudWatchLogs"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/ApiLogsRole/Resource"
   }
  },
  "AppSyncApiEBDAEC17": {
   "Type": "AWS::AppSync::GraphQLApi",
   "Properties": {
    "AuthenticationType": "API_KEY",
    "LogConfig": {
     "CloudWatchLogsRoleArn": {
      "Fn::GetAtt": [
       "AppSyncApiApiLogsRoleB99A02E9",
       "Arn"
      ]
     },
     "FieldLogLevel": "ALL"
    },
    "Name": "SystemApi",
    "XrayEnabled": true
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/Resource"
   }
  },
  "AppSyncApiSchemaD3A1C979": {
   "Type": "AWS::AppSync::GraphQLSchema",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "Definition": "# Composed GraphQL Schema\n# This file is auto-generated by scripts/compose-schema.ts\n# Do not edit this file directly. Edit domain schemas instead.\n\n# === CLAIMS DOMAIN ===\n# Claim Domain Schema\n\ntype Claim {\n  claimId: ID!\n  customerId: ID!\n  policyId: ID\n  claimType: String!\n  status: String!\n  amount: Float\n  submittedAt: AWSDateTime!\n  updatedAt: AWSDateTime!\n}\n\n\n\ntype ClaimConnection {\n  items: [Claim!]!\n  nextToken: String\n}\n\ntype ClaimWithCustomer {\n  claim: Claim!\n  customer: Customer!\n}\n\n# === CUSTOMERS DOMAIN ===\n# Customer Domain Schema\n\ntype Customer {\n  customerId: ID!\n  fullName: String!\n  email: String\n  phone: String\n  updatedAt: AWSDateTime!\n}\n\n# Import Claim types (will be merged by compose-schema.ts)\n# Claim and ClaimConnection are defined in claims domain\n\ntype CustomerWithClaims {\n  customer: Customer!\n  claims: ClaimConnection!\n}\n\ntype Query {\n  listClaimsByCustomer(customerId: ID!, limit: Int, nextToken: String): ClaimConnection\n  getClaimWithCustomer(claimId: ID!): ClaimWithCustomer\n  listClaimsByCustomerAurora(customerId: ID!, limit: Int, nextToken: String): ClaimConnection\n  getClaimWithCustomerAurora(claimId: ID!): ClaimWithCustomer\n  getCustomer(customerId: ID!): Customer\n  getCustomerByPhone(phone: String!): Customer\n  getCustomerByPhoneLambda(phone: String!): Customer\n  getCustomerByEmail(email: String!): Customer\n  getCustomerWithClaims(customerId: ID!, limit: Int, nextToken: String): CustomerWithClaims\n  getCustomerAurora(customerId: ID!): Customer\n  getCustomerByPhoneAurora(phone: String!): Customer\n  getCustomerByEmailAurora(email: String!): Customer\n  getCustomerWithClaimsAurora(customerId: ID!, limit: Int, nextToken: String): CustomerWithClaims\n}\n\nschema {\n  query: Query\n}"
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/Schema"
   }
  },
  "AppSyncApiDefaultApiKey4C5F84B8": {
   "Type": "AWS::AppSync::ApiKey",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "Expires": 1801291549
   },
   "DependsOn": [
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/DefaultApiKey"
   }
  },
  "AppSyncApiLogRetentionD549C903": {
   "Type": "Custom::LogRetention",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
      "Arn"
     ]
    },
    "LogGroupName": {
     "Fn::Join": [
      "",
      [
       "/aws/appsync/apis/",
       {
        "Fn::GetAtt": [
         "AppSyncApiEBDAEC17",
         "ApiId"
        ]
       }
      ]
     ]
    }
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/LogRetention/Resource"
   }
  },
  "AppSyncApiDynamoDataSourceServiceRole9A72A66A": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "appsync.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/DynamoDataSource/ServiceRole/Resource"
   }
  },
  "AppSyncApiDynamoDataSourceServiceRoleDefaultPolicy0C36E7A8": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:ConditionCheckItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable",
        "dynamodb:GetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:PutItem",
        "dynamodb:Query",
        "dynamodb:Scan",
        "dynamodb:UpdateItem"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "DynamoDBTableFD3F8884",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "DynamoDBTableFD3F8884",
             "Arn"
            ]
           },
           "/index/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "AppSyncApiDynamoDataSourceServiceRoleDefaultPolicy0C36E7A8",
    "Roles": [
     {
      "Ref": "AppSyncApiDynamoDataSourceServiceRole9A72A66A"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/DynamoDataSource/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "AppSyncApiDynamoDataSource22882DB1": {
   "Type": "AWS::AppSync::DataSource",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "DynamoDBConfig": {
     "AwsRegion": "ap-southeast-1",
     "TableName": {
      "Ref": "DynamoDBTableFD3F8884"
     }
    },
    "Name": "SystemApiDynamoDataSource",
    "ServiceRoleArn": {
     "Fn::GetAtt": [
      "AppSyncApiDynamoDataSourceServiceRole9A72A66A",
      "Arn"
     ]
    },
    "Type": "AMAZON_DYNAMODB"
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/DynamoDataSource/Resource"
   }
  },
  "AppSyncApiRdsDataSourceServiceRole3CB98E84": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "appsync.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/RdsDataSource/ServiceRole/Resource"
   }
  },
  "AppSyncApiRdsDataSourceServiceRoleDefaultPolicyF42A2E80": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "secretsmanager:DescribeSecret",
        "secretsmanager:GetSecretValue"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Ref": "AuroraCredentialsAttachmentD4B71BEE"
        },
        {
         "Ref": "AuroraCredentialsE58A9146"
        }
       ]
      },
      {
       "Action": [
        "rds-data:BatchExecuteStatement",
        "rds-data:BeginTransaction",
        "rds-data:CommitTransaction",
        "rds-data:ExecuteStatement",
        "rds-data:RollbackTransaction"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:aws:rds:ap-southeast-1:848360038404:cluster:",
          {
           "Ref": "AuroraClusterD4EFE71C"
          }
         ]
        ]
       }
      },
      {
       "Action": [
        "rds-data:DeleteItems",
        "rds-data:ExecuteSql",
        "rds-data:GetItems",
        "rds-data:InsertItems",
        "rds-data:UpdateItems"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:aws:rds:ap-southeast-1:848360038404:cluster:",
           {
            "Ref": "AuroraClusterD4EFE71C"
           },
           ":*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:aws:rds:ap-southeast-1:848360038404:cluster:",
           {
            "Ref": "AuroraClusterD4EFE71C"
           }
          ]
         ]
        }
       ]
      },
      {
       "Action": "rds-db:connect",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:aws:rds-db:ap-southeast-1:848360038404:dbuser:",
          {
           "Fn::Select": [
            6,
            {
             "Fn::Split": [
              ":",
              {
               "Fn::GetAtt": [
                "AuroraClusterProxy15D20DFD",
                "DBProxyArn"
               ]
              }
             ]
            }
           ]
          },
          "/postgres"
         ]
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "AppSyncApiRdsDataSourceServiceRoleDefaultPolicyF42A2E80",
    "Roles": [
     {
      "Ref": "AppSyncApiRdsDataSourceServiceRole3CB98E84"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/RdsDataSource/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "AppSyncApiRdsDataSource24DC42F9": {
   "Type": "AWS::AppSync::DataSource",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "Name": "RdsDataSource",
    "RelationalDatabaseConfig": {
     "RdsHttpEndpointConfig": {
      "AwsRegion": "ap-southeast-1",
      "AwsSecretStoreArn": {
       "Ref": "AuroraCredentialsE58A9146"
      },
      "DatabaseName": "systemapi",
      "DbClusterIdentifier": {
       "Fn::Join": [
        "",
        [
         "arn:aws:rds:ap-southeast-1:848360038404:cluster:",
         {
          "Ref": "AuroraClusterD4EFE71C"
         }
        ]
       ]
      }
     },
     "RelationalDatabaseSourceType": "RDS_HTTP_ENDPOINT"
    },
    "ServiceRoleArn": {
     "Fn::GetAtt": [
      "AppSyncApiRdsDataSourceServiceRole3CB98E84",
      "Arn"
     ]
    },
    "Type": "RELATIONAL_DATABASE"
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/RdsDataSource/Resource"
   }
  },
  "AppSyncApiDynamoDBGetCustomerResolver6BD35225": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/5b70cab790f0c2cec376741eb3f60ba3c830737666385a3b241db9a4afcfd7c1.js",
    "DataSourceName": "SystemApiDynamoDataSource",
    "FieldName": "getCustomer",
    "Kind": "UNIT",
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    },
    "TypeName": "Query"
   },
   "DependsOn": [
    "AppSyncApiDynamoDataSource22882DB1",
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/DynamoDBGetCustomerResolver/Resource"
   }
  },
  "AppSyncApiDynamoDBGetCustomerByEmailResolver508A74B0": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/023b0b9ab0f5dab6ccebeae2e29249d5f29f3c9428f77c336c70f04e559b927c.js",
    "DataSourceName": "SystemApiDynamoDataSource",
    "FieldName": "getCustomerByEmail",
    "Kind": "UNIT",
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    },
    "TypeName": "Query"
   },
   "DependsOn": [
    "AppSyncApiDynamoDataSource22882DB1",
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/DynamoDBGetCustomerByEmailResolver/Resource"
   }
  },
  "AppSyncApiDynamoDBGetCustomerByPhoneResolver13854AE2": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/a32ce196c41018340990e66bc91addb6d18f27861636789c04ddd645956719e5.js",
    "FieldName": "getCustomerByPhone",
    "Kind": "PIPELINE",
    "PipelineConfig": {
     "Functions": [
      {
       "Fn::GetAtt": [
        "DynamoDBResolversDynamoDBGetPhoneLookupFunction3DDEBF83",
        "FunctionId"
       ]
      },
      {
       "Fn::GetAtt": [
        "DynamoDBResolversDynamoDBGetCustomerProfileFunction4E9FFB6C",
        "FunctionId"
       ]
      }
     ]
    },
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    },
    "TypeName": "Query"
   },
   "DependsOn": [
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/DynamoDBGetCustomerByPhoneResolver/Resource"
   }
  },
  "AppSyncApiDynamoDBListClaimsByCustomerResolverEBF7BA10": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/c5dc01535af40f82671956478e66daaee480987774c6fede30c33d39bd83b4f8.js",
    "DataSourceName": "SystemApiDynamoDataSource",
    "FieldName": "listClaimsByCustomer",
    "Kind": "UNIT",
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    },
    "TypeName": "Query"
   },
   "DependsOn": [
    "AppSyncApiDynamoDataSource22882DB1",
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/DynamoDBListClaimsByCustomerResolver/Resource"
   }
  },
  "AppSyncApiDynamoDBGetCustomerWithClaimsResolverB6BFCC4C": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/03d445d9728b892d8be725bc04e42d1e5402bb2c6d2a985bfa8e45b6fd20c342.js",
    "FieldName": "getCustomerWithClaims",
    "Kind": "PIPELINE",
    "PipelineConfig": {
     "Functions": [
      {
       "Fn::GetAtt": [
        "DynamoDBResolversDynamoDBGetCustomerForClaimsFunction9C02D0AF",
        "FunctionId"
       ]
      },
      {
       "Fn::GetAtt": [
        "DynamoDBResolversDynamoDBGetClaimsForCustomerFunctionF400FAFF",
        "FunctionId"
       ]
      }
     ]
    },
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    },
    "TypeName": "Query"
   },
   "DependsOn": [
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/DynamoDBGetCustomerWithClaimsResolver/Resource"
   }
  },
  "AppSyncApiDynamoDBGetClaimWithCustomerResolverC2C02FE8": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/cfd666f341432043d2445161bbb51950dcf84a99dc60ab3547f9fb7eb2f21622.js",
    "FieldName": "getClaimWithCustomer",
    "Kind": "PIPELINE",
    "PipelineConfig": {
     "Functions": [
      {
       "Fn::GetAtt": [
        "DynamoDBResolversDynamoDBGetClaimProfileFunctionA88109AF",
        "FunctionId"
       ]
      },
      {
       "Fn::GetAtt": [
        "DynamoDBResolversDynamoDBGetCustomerForClaimFunction0708C424",
        "FunctionId"
       ]
      }
     ]
    },
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    },
    "TypeName": "Query"
   },
   "DependsOn": [
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/DynamoDBGetClaimWithCustomerResolver/Resource"
   }
  },
  "AppSyncApiAuroraGetCustomerResolver5223AA1C": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/cc08ba4bcbc74edb32266441e41151f9072b0b8f739dc8fa4146af27517b8b3d.js",
    "DataSourceName": "RdsDataSource",
    "FieldName": "getCustomerAurora",
    "Kind": "UNIT",
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    },
    "TypeName": "Query"
   },
   "DependsOn": [
    "AppSyncApiRdsDataSource24DC42F9",
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/AuroraGetCustomerResolver/Resource"
   }
  },
  "AppSyncApiAuroraGetCustomerByPhoneResolver4D05BD98": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/d70bb7f2d3f72d6e0e413c98c365ac808d5af7b1ba5f80cb36b995b52d9daa4d.js",
    "DataSourceName": "RdsDataSource",
    "FieldName": "getCustomerByPhoneAurora",
    "Kind": "UNIT",
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    },
    "TypeName": "Query"
   },
   "DependsOn": [
    "AppSyncApiRdsDataSource24DC42F9",
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/AuroraGetCustomerByPhoneResolver/Resource"
   }
  },
  "AppSyncApiAuroraGetCustomerByEmailResolverFDA4C3CB": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/c6727a6e084fee70ac27595555c662749e76e9db9ff499171929d56dc8b4e2e8.js",
    "DataSourceName": "RdsDataSource",
    "FieldName": "getCustomerByEmailAurora",
    "Kind": "UNIT",
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    },
    "TypeName": "Query"
   },
   "DependsOn": [
    "AppSyncApiRdsDataSource24DC42F9",
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/AuroraGetCustomerByEmailResolver/Resource"
   }
  },
  "AppSyncApiAuroraListClaimsByCustomerResolver62335F70": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/a659bde848d8974a2b75e6b7d997370752b1e2ce49b500a5a84ea72150dbd299.js",
    "DataSourceName": "RdsDataSource",
    "FieldName": "listClaimsByCustomerAurora",
    "Kind": "UNIT",
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    },
    "TypeName": "Query"
   },
   "DependsOn": [
    "AppSyncApiRdsDataSource24DC42F9",
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/AuroraListClaimsByCustomerResolver/Resource"
   }
  },
  "AppSyncApiAuroraGetCustomerWithClaimsResolverA8CCDEAB": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/b596e96d9d1474f508e086284ad7ef6ee6eea3c50956eecb379e1201b4168384.js",
    "DataSourceName": "RdsDataSource",
    "FieldName": "getCustomerWithClaimsAurora",
    "Kind": "UNIT",
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    },
    "TypeName": "Query"
   },
   "DependsOn": [
    "AppSyncApiRdsDataSource24DC42F9",
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/AuroraGetCustomerWithClaimsResolver/Resource"
   }
  },
  "AppSyncApiAuroraGetClaimWithCustomerResolverF4F54778": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/3135a310d93bd613dcdaec2ffe550ebfb3e0bfc8806fc14f51d07edf5826b38e.js",
    "DataSourceName": "RdsDataSource",
    "FieldName": "getClaimWithCustomerAurora",
    "Kind": "UNIT",
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    },
    "TypeName": "Query"
   },
   "DependsOn": [
    "AppSyncApiRdsDataSource24DC42F9",
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/AuroraGetClaimWithCustomerResolver/Resource"
   }
  },
  "AppSyncApiLambdaDataSourceServiceRole7186E2C5": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "appsync.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/LambdaDataSource/ServiceRole/Resource"
   }
  },
  "AppSyncApiLambdaDataSourceServiceRoleDefaultPolicy7F563284": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "LambdaResolversFindCustomerByPhoneLambda97D938BB",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "LambdaResolversFindCustomerByPhoneLambda97D938BB",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "AppSyncApiLambdaDataSourceServiceRoleDefaultPolicy7F563284",
    "Roles": [
     {
      "Ref": "AppSyncApiLambdaDataSourceServiceRole7186E2C5"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/LambdaDataSource/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "AppSyncApiLambdaDataSourceE2B6DE06": {
   "Type": "AWS::AppSync::DataSource",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "LambdaConfig": {
     "LambdaFunctionArn": {
      "Fn::GetAtt": [
       "LambdaResolversFindCustomerByPhoneLambda97D938BB",
       "Arn"
      ]
     }
    },
    "Name": "SystemApiLambdaDataSource",
    "ServiceRoleArn": {
     "Fn::GetAtt": [
      "AppSyncApiLambdaDataSourceServiceRole7186E2C5",
      "Arn"
     ]
    },
    "Type": "AWS_LAMBDA"
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/LambdaDataSource/Resource"
   }
  },
  "AppSyncApiLambdaGetCustomerByPhoneResolverA23A986A": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "DataSourceName": "SystemApiLambdaDataSource",
    "FieldName": "getCustomerByPhoneLambda",
    "Kind": "UNIT",
    "TypeName": "Query"
   },
   "DependsOn": [
    "AppSyncApiLambdaDataSourceE2B6DE06",
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/Api/LambdaGetCustomerByPhoneResolver/Resource"
   }
  },
  "AppSyncApiLogGroup770A7534": {
   "Type": "AWS::Logs::LogGroup",
   "Properties": {
    "LogGroupName": {
     "Fn::Join": [
      "",
      [
       "/aws/appsync/apis/",
       {
        "Fn::GetAtt": [
         "AppSyncApiEBDAEC17",
         "ApiId"
        ]
       }
      ]
     ]
    },
    "RetentionInDays": 7
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/AppSyncApi/LogGroup/Resource"
   }
  },
  "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/Resource"
   }
  },
  "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "logs:DeleteRetentionPolicy",
        "logs:PutRetentionPolicy"
       ],
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
    "Roles": [
     {
      "Ref": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Handler": "index.handler",
    "Runtime": "nodejs22.x",
    "Timeout": 900,
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-848360038404-ap-southeast-1",
     "S3Key": "2819175352ad1ce0dae768e83fc328fb70fb5f10b4a8ff0ccbcb791f02b0716d.zip"
    },
    "Role": {
     "Fn::GetAtt": [
      "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
      "Arn"
     ]
    }
   },
   "DependsOn": [
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Resource",
    "aws:asset:path": "asset.2819175352ad1ce0dae768e83fc328fb70fb5f10b4a8ff0ccbcb791f02b0716d",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "DynamoDBTableFD3F8884": {
   "Type": "AWS::DynamoDB::Table",
   "Properties": {
    "AttributeDefinitions": [
     {
      "AttributeName": "PK",
      "AttributeType": "S"
     },
     {
      "AttributeName": "SK",
      "AttributeType": "S"
     },
     {
      "AttributeName": "GSI1PK",
      "AttributeType": "S"
     },
     {
      "AttributeName": "GSI1SK",
      "AttributeType": "S"
     }
    ],
    "BillingMode": "PAY_PER_REQUEST",
    "GlobalSecondaryIndexes": [
     {
      "IndexName": "GSI1",
      "KeySchema": [
       {
        "AttributeName": "GSI1PK",
        "KeyType": "HASH"
       },
       {
        "AttributeName": "GSI1SK",
        "KeyType": "RANGE"
       }
      ],
      "Projection": {
       "ProjectionType": "ALL"
      }
     }
    ],
    "KeySchema": [
     {
      "AttributeName": "PK",
      "KeyType": "HASH"
     },
     {
      "AttributeName": "SK",
      "KeyType": "RANGE"
     }
    ],
    "PointInTimeRecoverySpecification": {
     "PointInTimeRecoveryEnabled": false
    },
    "TableName": "SystemApiTable"
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/DynamoDB/Table/Resource"
   }
  },
  "AuroraVpc881E9D7F": {
   "Type": "AWS::EC2::VPC",
   "Properties": {
    "CidrBlock": "10.0.0.0/16",
    "EnableDnsHostnames": true,
    "EnableDnsSupport": true,
    "InstanceTenancy": "default",
    "Tags": [
     {
      "Key": "Name",
      "Value": "SystemApiStack/Aurora/Vpc"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Vpc/Resource"
   }
  },
  "AuroraVpcaurorasubnetSubnet1Subnet6F944A8D": {
   "Type": "AWS::EC2::Subnet",
   "Properties": {
    "AvailabilityZone": "ap-southeast-1a",
    "CidrBlock": "10.0.0.0/24",
    "MapPublicIpOnLaunch": false,
    "Tags": [
     {
      "Key": "aws-cdk:subnet-name",
      "Value": "aurora-subnet"
     },
     {
      "Key": "aws-cdk:subnet-type",
      "Value": "Isolated"
     },
     {
      "Key": "Name",
      "Value": "SystemApiStack/Aurora/Vpc/aurora-subnetSubnet1"
     }
    ],
    "VpcId": {
     "Ref": "AuroraVpc881E9D7F"
    }
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Vpc/aurora-subnetSubnet1/Subnet"
   }
  },
  "AuroraVpcaurorasubnetSubnet1RouteTableECC20BB4": {
   "Type": "AWS::EC2::RouteTable",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "SystemApiStack/Aurora/Vpc/aurora-subnetSubnet1"
     }
    ],
    "VpcId": {
     "Ref": "AuroraVpc881E9D7F"
    }
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Vpc/aurora-subnetSubnet1/RouteTable"
   }
  },
  "AuroraVpcaurorasubnetSubnet1RouteTableAssociation6E46E1E9": {
   "Type": "AWS::EC2::SubnetRouteTableAssociation",
   "Properties": {
    "RouteTableId": {
     "Ref": "AuroraVpcaurorasubnetSubnet1RouteTableECC20BB4"
    },
    "SubnetId": {
     "Ref": "AuroraVpcaurorasubnetSubnet1Subnet6F944A8D"
    }
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Vpc/aurora-subnetSubnet1/RouteTableAssociation"
   }
  },
  "AuroraVpcaurorasubnetSubnet2Subnet0E72BD3C": {
   "Type": "AWS::EC2::Subnet",
   "Properties": {
    "AvailabilityZone": "ap-southeast-1b",
    "CidrBlock": "10.0.1.0/24",
    "MapPublicIpOnLaunch": false,
    "Tags": [
     {
      "Key": "aws-cdk:subnet-name",
      "Value": "aurora-subnet"
     },
     {
      "Key": "aws-cdk:subnet-type",
      "Value": "Isolated"
     },
     {
      "Key": "Name",
      "Value": "SystemApiStack/Aurora/Vpc/aurora-subnetSubnet2"
     }
    ],
    "VpcId": {
     "Ref": "AuroraVpc881E9D7F"
    }
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Vpc/aurora-subnetSubnet2/Subnet"
   }
  },
  "AuroraVpcaurorasubnetSubnet2RouteTable01294F69": {
   "Type": "AWS::EC2::RouteTable",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "SystemApiStack/Aurora/Vpc/aurora-subnetSubnet2"
     }
    ],
    "VpcId": {
     "Ref": "AuroraVpc881E9D7F"
    }
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Vpc/aurora-subnetSubnet2/RouteTable"
   }
  },
  "AuroraVpcaurorasubnetSubnet2RouteTableAssociationA4D4747C": {
   "Type": "AWS::EC2::SubnetRouteTableAssociation",
   "Properties": {
    "RouteTableId": {
     "Ref": "AuroraVpcaurorasubnetSubnet2RouteTable01294F69"
    },
    "SubnetId": {
     "Ref": "AuroraVpcaurorasubnetSubnet2Subnet0E72BD3C"
    }
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Vpc/aurora-subnetSubnet2/RouteTableAssociation"
   }
  },
  "AuroraVpcRestrictDefaultSecurityGroupCustomResource5D5DF414": {
   "Type": "Custom::VpcRestrictDefaultSG",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "CustomVpcRestrictDefaultSGCustomResourceProviderHandlerDC833E5E",
      "Arn"
     ]
    },
    "DefaultSecurityGroupId": {
     "Fn::GetAtt": [
      "AuroraVpc881E9D7F",
      "DefaultSecurityGroup"
     ]
    },
    "Account": "848360038404"
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Vpc/RestrictDefaultSecurityGroupCustomResource/Default"
   }
  },
  "AuroraAuroraSecurityGroup8305B1C8": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "Security group for Aurora cluster",
    "SecurityGroupEgress": [
     {
      "CidrIp": "255.255.255.255/32",
      "Description": "Disallow all traffic",
      "FromPort": 252,
      "IpProtocol": "icmp",
      "ToPort": 86
     }
    ],
    "VpcId": {
     "Ref": "AuroraVpc881E9D7F"
    }
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/AuroraSecurityGroup/Resource"
   }
  },
  "AuroraAuroraSecurityGroupfromSystemApiStackAuroraRdsProxySecurityGroup6B49B34C5432E9DE3D44": {
   "Type": "AWS::EC2::SecurityGroupIngress",
   "Properties": {
    "Description": "Allow RDS Proxy to connect to Aurora",
    "FromPort": 5432,
    "GroupId": {
     "Fn::GetAtt": [
      "AuroraAuroraSecurityGroup8305B1C8",
      "GroupId"
     ]
    },
    "IpProtocol": "tcp",
    "SourceSecurityGroupId": {
     "Fn::GetAtt": [
      "AuroraRdsProxySecurityGroup5FA312C7",
      "GroupId"
     ]
    },
    "ToPort": 5432
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/AuroraSecurityGroup/from SystemApiStackAuroraRdsProxySecurityGroup6B49B34C:5432"
   }
  },
  "AuroraAuroraSecurityGroupfromSystemApiStackAuroraRdsProxySecurityGroup6B49B34CIndirectPortA87FFAF3": {
   "Type": "AWS::EC2::SecurityGroupIngress",
   "Properties": {
    "Description": "Allow connections to the database Cluster from the Proxy",
    "FromPort": {
     "Fn::GetAtt": [
      "AuroraClusterD4EFE71C",
      "Endpoint.Port"
     ]
    },
    "GroupId": {
     "Fn::GetAtt": [
      "AuroraAuroraSecurityGroup8305B1C8",
      "GroupId"
     ]
    },
    "IpProtocol": "tcp",
    "SourceSecurityGroupId": {
     "Fn::GetAtt": [
      "AuroraRdsProxySecurityGroup5FA312C7",
      "GroupId"
     ]
    },
    "ToPort": {
     "Fn::GetAtt": [
      "AuroraClusterD4EFE71C",
      "Endpoint.Port"
     ]
    }
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/AuroraSecurityGroup/from SystemApiStackAuroraRdsProxySecurityGroup6B49B34C:{IndirectPort}"
   }
  },
  "AuroraRdsProxySecurityGroup5FA312C7": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "Security group for RDS Proxy",
    "SecurityGroupEgress": [
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow all outbound traffic by default",
      "IpProtocol": "-1"
     }
    ],
    "VpcId": {
     "Ref": "AuroraVpc881E9D7F"
    }
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/RdsProxySecurityGroup/Resource"
   }
  },
  "AuroraCredentialsE58A9146": {
   "Type": "AWS::SecretsManager::Secret",
   "Properties": {
    "Description": "Credentials for Aurora PostgreSQL database",
    "GenerateSecretString": {
     "ExcludeCharacters": "\"@/\\",
     "GenerateStringKey": "password",
     "SecretStringTemplate": "{\"username\":\"postgres\"}"
    },
    "Name": "aurora-db-credentials"
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Credentials/Resource"
   }
  },
  "AuroraCredentialsAttachmentD4B71BEE": {
   "Type": "AWS::SecretsManager::SecretTargetAttachment",
   "Properties": {
    "SecretId": {
     "Ref": "AuroraCredentialsE58A9146"
    },
    "TargetId": {
     "Ref": "AuroraClusterD4EFE71C"
    },
    "TargetType": "AWS::RDS::DBCluster"
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Credentials/Attachment/Resource"
   }
  },
  "AuroraClusterSubnets1025DD82": {
   "Type": "AWS::RDS::DBSubnetGroup",
   "Properties": {
    "DBSubnetGroupDescription": "Subnets for Cluster database",
    "SubnetIds": [
     {
      "Ref": "AuroraVpcaurorasubnetSubnet1Subnet6F944A8D"
     },
     {
      "Ref": "AuroraVpcaurorasubnetSubnet2Subnet0E72BD3C"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Cluster/Subnets/Default"
   }
  },
  "AuroraClusterD4EFE71C": {
   "Type": "AWS::RDS::DBCluster",
   "Properties": {
    "CopyTagsToSnapshot": true,
    "DBClusterParameterGroupName": "default.aurora-postgresql17",
    "DBSubnetGroupName": {
     "Ref": "AuroraClusterSubnets1025DD82"
    },
    "DatabaseName": "systemapi",
    "DeletionProtection": false,
    "EnableCloudwatchLogsExports": [
     "postgresql"
    ],
    "EnableHttpEndpoint": true,
    "Engine": "aurora-postgresql",
    "EngineVersion": "17.6",
    "MasterUserPassword": {
     "Fn::Join": [
      "",
      [
       "{{resolve:secretsmanager:",
       {
        "Ref": "AuroraCredentialsE58A9146"
       },
       ":SecretString:password::}}"
      ]
     ]
    },
    "MasterUsername": {
     "Fn::Join": [
      "",
      [
       "{{resolve:secretsmanager:",
       {
        "Ref": "AuroraCredentialsE58A9146"
       },
       ":SecretString:username::}}"
      ]
     ]
    },
    "Port": 5432,
    "ServerlessV2ScalingConfiguration": {
     "MaxCapacity": 4,
     "MinCapacity": 0.5
    },
    "VpcSecurityGroupIds": [
     {
      "Fn::GetAtt": [
       "AuroraAuroraSecurityGroup8305B1C8",
       "GroupId"
      ]
     }
    ]
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Cluster/Resource"
   }
  },
  "AuroraClusterwriter0A1D211B": {
   "Type": "AWS::RDS::DBInstance",
   "Properties": {
    "DBClusterIdentifier": {
     "Ref": "AuroraClusterD4EFE71C"
    },
    "DBInstanceClass": "db.serverless",
    "EnablePerformanceInsights": false,
    "Engine": "aurora-postgresql",
    "PromotionTier": 0,
    "PubliclyAccessible": false
   },
   "DependsOn": [
    "AuroraVpcaurorasubnetSubnet1RouteTableAssociation6E46E1E9",
    "AuroraVpcaurorasubnetSubnet2RouteTableAssociationA4D4747C"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Cluster/writer/Resource"
   }
  },
  "AuroraClusterProxyIAMRole5ADBACEF": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "rds.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Cluster/Proxy/IAMRole/Resource"
   }
  },
  "AuroraClusterProxyIAMRoleDefaultPolicy3880F951": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "secretsmanager:DescribeSecret",
        "secretsmanager:GetSecretValue"
       ],
       "Effect": "Allow",
       "Resource": {
        "Ref": "AuroraCredentialsE58A9146"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "AuroraClusterProxyIAMRoleDefaultPolicy3880F951",
    "Roles": [
     {
      "Ref": "AuroraClusterProxyIAMRole5ADBACEF"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Cluster/Proxy/IAMRole/DefaultPolicy/Resource"
   }
  },
  "AuroraClusterProxy15D20DFD": {
   "Type": "AWS::RDS::DBProxy",
   "Properties": {
    "Auth": [
     {
      "AuthScheme": "SECRETS",
      "IAMAuth": "DISABLED",
      "SecretArn": {
       "Ref": "AuroraCredentialsE58A9146"
      }
     }
    ],
    "DBProxyName": "aurora-systemapi-proxy",
    "EngineFamily": "POSTGRESQL",
    "RequireTLS": true,
    "RoleArn": {
     "Fn::GetAtt": [
      "AuroraClusterProxyIAMRole5ADBACEF",
      "Arn"
     ]
    },
    "VpcSecurityGroupIds": [
     {
      "Fn::GetAtt": [
       "AuroraRdsProxySecurityGroup5FA312C7",
       "GroupId"
      ]
     }
    ],
    "VpcSubnetIds": [
     {
      "Ref": "AuroraVpcaurorasubnetSubnet1Subnet6F944A8D"
     },
     {
      "Ref": "AuroraVpcaurorasubnetSubnet2Subnet0E72BD3C"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Cluster/Proxy/Resource"
   }
  },
  "AuroraClusterProxyProxyTargetGroupCEFB4C20": {
   "Type": "AWS::RDS::DBProxyTargetGroup",
   "Properties": {
    "ConnectionPoolConfigurationInfo": {
     "ConnectionBorrowTimeout": 120,
     "MaxConnectionsPercent": 100,
     "MaxIdleConnectionsPercent": 50
    },
    "DBClusterIdentifiers": [
     {
      "Ref": "AuroraClusterD4EFE71C"
     }
    ],
    "DBProxyName": {
     "Ref": "AuroraClusterProxy15D20DFD"
    },
    "TargetGroupName": "default"
   },
   "DependsOn": [
    "AuroraClusterD4EFE71C",
    "AuroraClusterwriter0A1D211B"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Aurora/Cluster/Proxy/ProxyTargetGroup"
   }
  },
  "CustomVpcRestrictDefaultSGCustomResourceProviderRole26592FE0": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Version": "2012-10-17",
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ]
    },
    "ManagedPolicyArns": [
     {
      "Fn::Sub": "arn:${AWS::Partition}:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
     }
    ],
    "Policies": [
     {
      "PolicyName": "Inline",
      "PolicyDocument": {
       "Version": "2012-10-17",
       "Statement": [
        {
         "Effect": "Allow",
         "Action": [
          "ec2:AuthorizeSecurityGroupIngress",
          "ec2:AuthorizeSecurityGroupEgress",
          "ec2:RevokeSecurityGroupIngress",
          "ec2:RevokeSecurityGroupEgress"
         ],
         "Resource": [
          {
           "Fn::Join": [
            "",
            [
             "arn:aws:ec2:ap-southeast-1:848360038404:security-group/",
             {
              "Fn::GetAtt": [
               "AuroraVpc881E9D7F",
               "DefaultSecurityGroup"
              ]
             }
            ]
           ]
          }
         ]
        }
       ]
      }
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Custom::VpcRestrictDefaultSGCustomResourceProvider/Role"
   }
  },
  "CustomVpcRestrictDefaultSGCustomResourceProviderHandlerDC833E5E": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-848360038404-ap-southeast-1",
     "S3Key": "7fa1e366ee8a9ded01fc355f704cff92bfd179574e6f9cfee800a3541df1b200.zip"
    },
    "Timeout": 900,
    "MemorySize": 128,
    "Handler": "__entrypoint__.handler",
    "Role": {
     "Fn::GetAtt": [
      "CustomVpcRestrictDefaultSGCustomResourceProviderRole26592FE0",
      "Arn"
     ]
    },
    "Runtime": "nodejs22.x",
    "Description": "Lambda function for removing all inbound/outbound rules from the VPC default security group"
   },
   "DependsOn": [
    "CustomVpcRestrictDefaultSGCustomResourceProviderRole26592FE0"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/Custom::VpcRestrictDefaultSGCustomResourceProvider/Handler",
    "aws:asset:path": "asset.7fa1e366ee8a9ded01fc355f704cff92bfd179574e6f9cfee800a3541df1b200",
    "aws:asset:property": "Code"
   }
  },
  "DynamoDBResolversDynamoDBGetPhoneLookupFunction3DDEBF83": {
   "Type": "AWS::AppSync::FunctionConfiguration",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/a445a78593ddf5f46da5e75de24800440dde63f9f077c8eade4159dc97ce4dda.js",
    "DataSourceName": "SystemApiDynamoDataSource",
    "FunctionVersion": "2018-05-29",
    "Name": "SystemApiGetPhoneLookup",
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    }
   },
   "DependsOn": [
    "AppSyncApiDynamoDataSource22882DB1",
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/DynamoDBResolvers/DynamoDBGetPhoneLookupFunction/Resource"
   }
  },
  "DynamoDBResolversDynamoDBGetCustomerProfileFunction4E9FFB6C": {
   "Type": "AWS::AppSync::FunctionConfiguration",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/1c95d0736018cb234ee065bd2d3ed955678bf8fc234e2276bd750d0d0e0b5678.js",
    "DataSourceName": "SystemApiDynamoDataSource",
    "FunctionVersion": "2018-05-29",
    "Name": "SystemApiGetCustomerProfile",
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    }
   },
   "DependsOn": [
    "AppSyncApiDynamoDataSource22882DB1",
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/DynamoDBResolvers/DynamoDBGetCustomerProfileFunction/Resource"
   }
  },
  "DynamoDBResolversDynamoDBGetCustomerForClaimsFunction9C02D0AF": {
   "Type": "AWS::AppSync::FunctionConfiguration",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/5317b24180b03000da72f3906a3ce5063e96c1d22c6b8e3318c9dbda022d2874.js",
    "DataSourceName": "SystemApiDynamoDataSource",
    "FunctionVersion": "2018-05-29",
    "Name": "SystemApiGetCustomerForClaims",
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    }
   },
   "DependsOn": [
    "AppSyncApiDynamoDataSource22882DB1",
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/DynamoDBResolvers/DynamoDBGetCustomerForClaimsFunction/Resource"
   }
  },
  "DynamoDBResolversDynamoDBGetClaimsForCustomerFunctionF400FAFF": {
   "Type": "AWS::AppSync::FunctionConfiguration",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/7391b24980c2e875efa47d1c32f160c2253691bc2447f0d03ebab6d207b447b8.js",
    "DataSourceName": "SystemApiDynamoDataSource",
    "FunctionVersion": "2018-05-29",
    "Name": "SystemApiGetClaimsForCustomer",
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    }
   },
   "DependsOn": [
    "AppSyncApiDynamoDataSource22882DB1",
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/DynamoDBResolvers/DynamoDBGetClaimsForCustomerFunction/Resource"
   }
  },
  "DynamoDBResolversDynamoDBGetClaimProfileFunctionA88109AF": {
   "Type": "AWS::AppSync::FunctionConfiguration",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/96e83e12bd75a265babaa87d3dd686983bb8c67843a7584661b0e969bdfd75e8.js",
    "DataSourceName": "SystemApiDynamoDataSource",
    "FunctionVersion": "2018-05-29",
    "Name": "SystemApiGetClaimProfile",
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    }
   },
   "DependsOn": [
    "AppSyncApiDynamoDataSource22882DB1",
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/DynamoDBResolvers/DynamoDBGetClaimProfileFunction/Resource"
   }
  },
  "DynamoDBResolversDynamoDBGetCustomerForClaimFunction0708C424": {
   "Type": "AWS::AppSync::FunctionConfiguration",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "AppSyncApiEBDAEC17",
      "ApiId"
     ]
    },
    "CodeS3Location": "s3://cdk-hnb659fds-assets-848360038404-ap-southeast-1/e6a9b1641a9982eb0d5f91045aa40fa67594c1fc4f1793fc471cd5213575f6c6.js",
    "DataSourceName": "SystemApiDynamoDataSource",
    "FunctionVersion": "2018-05-29",
    "Name": "SystemApiGetCustomerForClaim",
    "Runtime": {
     "Name": "APPSYNC_JS",
     "RuntimeVersion": "1.0.0"
    }
   },
   "DependsOn": [
    "AppSyncApiDynamoDataSource22882DB1",
    "AppSyncApiSchemaD3A1C979"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/DynamoDBResolvers/DynamoDBGetCustomerForClaimFunction/Resource"
   }
  },
  "LambdaResolversFindCustomerByPhoneLambdaServiceRoleDA2EFFAC": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/LambdaResolvers/FindCustomerByPhoneLambda/ServiceRole/Resource"
   }
  },
  "LambdaResolversFindCustomerByPhoneLambdaServiceRoleDefaultPolicyBA4423F7": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:ConditionCheckItem",
        "dynamodb:DescribeTable",
        "dynamodb:GetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:Scan"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "DynamoDBTableFD3F8884",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "DynamoDBTableFD3F8884",
             "Arn"
            ]
           },
           "/index/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LambdaResolversFindCustomerByPhoneLambdaServiceRoleDefaultPolicyBA4423F7",
    "Roles": [
     {
      "Ref": "LambdaResolversFindCustomerByPhoneLambdaServiceRoleDA2EFFAC"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/LambdaResolvers/FindCustomerByPhoneLambda/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "LambdaResolversFindCustomerByPhoneLambda97D938BB": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-848360038404-ap-southeast-1",
     "S3Key": "b71e23d1b608952266ab10ac864b0a1f38f427a86cdd7bf4554fe8a6ee80e8c7.zip"
    },
    "Environment": {
     "Variables": {
      "TABLE_NAME": {
       "Ref": "DynamoDBTableFD3F8884"
      }
     }
    },
    "FunctionName": "SystemApiFindCustomerByPhoneLambda",
    "Handler": "index.handler",
    "Role": {
     "Fn::GetAtt": [
      "LambdaResolversFindCustomerByPhoneLambdaServiceRoleDA2EFFAC",
      "Arn"
     ]
    },
    "Runtime": "nodejs20.x",
    "Timeout": 10
   },
   "DependsOn": [
    "LambdaResolversFindCustomerByPhoneLambdaServiceRoleDefaultPolicyBA4423F7",
    "LambdaResolversFindCustomerByPhoneLambdaServiceRoleDA2EFFAC"
   ],
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/LambdaResolvers/FindCustomerByPhoneLambda/Resource",
    "aws:asset:path": "asset.b71e23d1b608952266ab10ac864b0a1f38f427a86cdd7bf4554fe8a6ee80e8c7",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/31STU/jMBD9LdxdwxbtgWObCoSotN0EcUUTZ0hNEzvrj0IU5b/v2CZpYVec5r3n8Xwv+fL6J/9xAW92IarDopElHwoH4sBIeh6g62yvBB/uDHT7P82qkyx7UZH93n5mhdhjC0Eg/QF7tukVtHpTbsBBob0RGB7PWF7Zc4ZWN0c0wWnGW2jLCs68VqmiW6+Ek1oF5wlnWr3I2hsIZGQSWj7kuolZo93pRoo+0IRG1uja8mGr6xwdqhiQyJ3RvgtuEx6ZvX4Ga9FZvgqGOF97cUC3Bousip1WNLtHKFPCCEaGYsmHp04E6WmXsZ2RR3BY+FJRFBJPKNfe4fw/6SeN0mohY2usQOGNdP1c5/fCvaoNWktNoDDUQgsKajS06Mg//ANK5hFMjW7l6Az2LU3l5PD1ZWSmovmF9ZQ0h6zx1tHSUu1zMZv1P8LkGcm9sg4U7XaKszP6vU9vX2Gq4GMpTTwOPvzvGMYxHtR0dTOO66MLr6WqWUZV6Pbk94lSvqOs0MQNU4hf3nWeWla6Qv5qL4/LK37Dry5erZQL4+l6WuR5sn8BwXXcPlgDAAA="
   },
   "Metadata": {
    "aws:cdk:path": "SystemApiStack/CDKMetadata/Default"
   }
  }
 },
 "Outputs": {
  "GraphQLEndpoint": {
   "Description": "AppSync GraphQL API Endpoint",
   "Value": {
    "Fn::GetAtt": [
     "AppSyncApiEBDAEC17",
     "GraphQLUrl"
    ]
   }
  },
  "ApiKey": {
   "Description": "AppSync API Key",
   "Value": {
    "Fn::GetAtt": [
     "AppSyncApiDefaultApiKey4C5F84B8",
     "ApiKey"
    ]
   }
  },
  "ApiId": {
   "Description": "AppSync API ID",
   "Value": {
    "Fn::GetAtt": [
     "AppSyncApiEBDAEC17",
     "ApiId"
    ]
   }
  },
  "DynamoDBTableName": {
   "Description": "DynamoDB Table Name",
   "Value": {
    "Ref": "DynamoDBTableFD3F8884"
   }
  },
  "AuroraClusterEndpoint": {
   "Description": "Aurora Cluster Endpoint",
   "Value": {
    "Fn::GetAtt": [
     "AuroraClusterD4EFE71C",
     "Endpoint.Address"
    ]
   }
  },
  "RdsProxyEndpoint": {
   "Description": "RDS Proxy Endpoint",
   "Value": {
    "Fn::GetAtt": [
     "AuroraClusterProxy15D20DFD",
     "Endpoint"
    ]
   }
  },
  "DatabaseSecretArn": {
   "Description": "Secrets Manager ARN for database credentials",
   "Value": {
    "Ref": "AuroraCredentialsE58A9146"
   }
  },
  "DatabaseName": {
   "Description": "Database name",
   "Value": "systemapi"
  },
  "AuroraClusterArn": {
   "Description": "Aurora Cluster ARN (for RDS Data API)",
   "Value": {
    "Fn::Join": [
     "",
     [
      "arn:aws:rds:ap-southeast-1:848360038404:cluster:",
      {
       "Ref": "AuroraClusterD4EFE71C"
      }
     ]
    ]
   }
  },
  "Region": {
   "Description": "AWS Region",
   "Value": "ap-southeast-1"
  }
 },
 "Parameters": {
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}